<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <style>
    .root {
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
    }

    .form {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    .form.active {
      display: block;
    }

    .form.inactive {
      display: none;
    }

    .form-wrapper {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    h5 {
      font-size: 24px;
      margin: 0;
      text-align: center;
      color: #333;
    }

    .form-field {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      outline: none;
      transition: border-color 0.3s;
      width: 100%;
    }

    .form-field:focus {
      border-color: #007bff;
    }

    .button {
      padding: 12px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
      width: 100%;
      margin: 5px 0;
    }

    .button.primary {
      background: #007bff;
      color: white;
    }

    .button.primary:hover {
      background: #0056b3;
    }

    .button.secondary {
      background: #f8f9fa;
      color: #333;
      border: 1px solid #ddd;
    }

    .button.secondary:hover {
      background: #e2e6ea;
    }

    .business-fields {
      display: none;
    }

    .social-login {
      margin-top: 20px;
    }

    .social-login a {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      text-align: center;
      border-radius: 5px;
      color: white;
      text-decoration: none;
    }

    .btn-google {
      background: #dc3545;
    }

    .btn-kakao {
      background: #ffc107;
      color: #000 !important;
    }

    .btn-naver {
      background: #28a745;
    }

    .view-options {
      text-align: center;
      margin-top: 20px;
      color: #666;
    }

    .view-options a {
      color: #007bff;
      text-decoration: none;
      cursor: pointer;
    }

    .view-options a:hover {
      text-decoration: underline;
    }

    /* ì•Œë¦¼ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    .alert-success {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      color: #155724;
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
      text-align: center;
    }

    .alert-danger {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      color: #721c24;
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      text-align: center;
    }

    /* ê¸°ì¡´ .social-login ìŠ¤íƒ€ì¼ì„ ì•„ë˜ ì½”ë“œë¡œ êµì²´ */
    .social-login {
      margin: 20px 0;
      text-align: center;
    }

    .social-text {
      color: #666;
      margin-bottom: 15px;
    }

    .social-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px 0;
    }

    .social-circle {
      position: relative;  /* ì¶”ê°€ */
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: white;
      border: 1px solid #eee;
      overflow: hidden;   /* ì¶”ê°€ */
      padding: 0;
    }

    .social-circle:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .social-circle img {
      position: absolute;  /* ì¶”ê°€ */
      top: 50%;           /* ì¶”ê°€ */
      left: 50%;          /* ì¶”ê°€ */
      transform: translate(-50%, -50%);  /* ì¶”ê°€ */
      width: 40px;
      height: 40px;
      object-fit: contain;
    }

    .divider {
      position: relative;
      text-align: center;
      margin: 15px 0;
    }

    .divider::before,
    .divider::after {
      content: "";
      position: absolute;
      top: 50%;
      width: 45%;
      height: 1px;
      background-color: #eee;
    }

    .divider::before {
      left: 0;
    }

    .divider::after {
      right: 0;
    }

    .divider span {
      background-color: white;
      padding: 0 15px;
      color: #888;
      font-size: 13px;
    }
  </style>
</head>

<div layout:fragment="content">
  <div class="root">
    <!-- ë¡œê·¸ì¸ í¼ -->
    <div class="signin-wrapper form active">
      <div class="form-wrapper">
        <h5>Welcome Back ğŸ‘Š</h5>
        <!-- ë©”ì‹œì§€ ì˜ì—­ -->
        <div th:if="${message}" class="alert-success">
          <p th:text="${message}"></p>
        </div>
        <div th:if="${errorMessage}" class="alert-danger">
          <p th:text="${errorMessage}"></p>
        </div>
        <div th:if="${loginErrorMsg}" class="alert-danger">
          <p th:text="${loginErrorMsg}"></p>
        </div>

        <form th:action="@{/members/login/process}" method="post">
          <input type="email" name="email" class="form-field" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
          <input type="password" name="password" class="form-field" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>

          <button type="submit" class="button primary">ë¡œê·¸ì¸</button>
          <button type="button" class="button secondary" id="click-signup">íšŒì›ê°€ì…</button>

          <div class="social-login">
            <div class="divider">
              <span>ë˜ëŠ”</span>
            </div>
            <p class="social-text">ì†Œì…œ ë¡œê·¸ì¸</p>
            <div class="social-buttons">
              <a href="/oauth2/authorization/google" class="social-circle google">
                <img src="https://www.google.com/images/branding/googleg/1x/googleg_standard_color_128dp.png" alt="êµ¬ê¸€ ë¡œê·¸ì¸">
              </a>
              <a href="/oauth2/authorization/kakao" class="social-circle kakao">
                <img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png" alt="ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸">
              </a>
              <a href="/oauth2/authorization/naver" class="social-circle naver">
                <img src="https://static.nid.naver.com/oauth/button_g.PNG" alt="ë„¤ì´ë²„ ë¡œê·¸ì¸">
              </a>
            </div>

          </div>

          <div class="view-options">
            <p>
              view concept for
              <a id="mobile"><b>mobile</b></a>
              or for
              <a id="desk"><b>desktop</b></a>
            </p>
          </div>
        </form>
      </div>
    </div>
    <!-- íšŒì›ê°€ì… í¼ -->
    <div class="signup-wrapper form inactive">
      <div class="form-wrapper">
        <h5>ğŸ‘‹ Hello</h5>
        <form th:action="@{/members/new}" method="post" th:object="${memberFormDto}">
          <select th:field="*{role}" class="form-field" id="role">
            <option value="USER">ì¼ë°˜ ê°œì¸ íšŒì›</option>
            <option value="MANAGER">íŒë§¤ì</option>
          </select>

          <input type="text" th:field="*{name}" class="form-field" id="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
          <div th:if="${#fields.hasErrors('name')}" class="alert-danger">
            <p th:errors="*{name}"></p>
          </div>

          <div class="business-fields">
            <input type="text" th:field="*{businessNumber}" class="form-field"
                   placeholder="ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
            <div th:if="${#fields.hasErrors('businessNumber')}" class="alert-danger">
              <p th:errors="*{businessNumber}"></p>
            </div>
          </div>

          <input type="email" th:field="*{email}" class="form-field" id="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
          <button type="button" class="button secondary" onclick="checkEmail()">ì´ë©”ì¼ ì¤‘ë³µí™•ì¸</button>
          <div id="emailStatus"></div>
          <div th:if="${#fields.hasErrors('email')}" class="alert-danger">
            <p th:errors="*{email}"></p>
          </div>

          <input type="password" th:field="*{password}" class="form-field" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>
          <input type="password" th:field="*{confirmPassword}" class="form-field" id="confirmPassword"
                 placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
          <div id="passwordMatch"></div>
          <div th:if="${#fields.hasErrors('password')}" class="alert-danger">
            <p th:errors="*{password}"></p>
          </div>

          <div class="address-wrapper">
            <div class="zipcode-wrapper" style="display: flex; gap: 10px;">
              <input type="text" th:field="*{zipcode}" class="form-field" id="zipcode"
                     placeholder="ìš°í¸ë²ˆí˜¸" style="flex: 1;" readonly>
              <button type="button" class="button secondary" onclick="execDaumPostcode()"
                      style="width: auto;">ì£¼ì†Œ ì°¾ê¸°</button>
            </div>
            <input type="text" th:field="*{address}" class="form-field" id="address"
                   placeholder="ì£¼ì†Œ" readonly>
            <input type="text" th:field="*{addressDetail}" class="form-field" id="addressDetail"
                   placeholder="ìƒì„¸ì£¼ì†Œ">
          </div>

          <button type="submit" class="button primary">ê°€ì…í•˜ê¸°</button>
          <button type="button" class="button secondary" id="click-signin">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>

          <div class="view-options">
            <p>
              view concept for
              <a id="mobile"><b>mobile</b></a>
              or for
              <a id="desk"><b>desktop</b></a>
            </p>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script th:inline="javascript">
    $(document).ready(function(){
      // ë©”ì‹œì§€ê°€ ìˆì„ ê²½ìš° ë¡œê·¸ì¸ í¼ìœ¼ë¡œ ì „í™˜
      var message = [[${message}]];
      var errorMessage = [[${errorMessage}]];
      if(message || errorMessage) {
        $(".signup-wrapper").removeClass("active").addClass("inactive");
        $(".signin-wrapper").removeClass("inactive").addClass("active");
      }

      // í¼ ì „í™˜
      $("#click-signup").click(function() {
        $(".signin-wrapper").removeClass("active").addClass("inactive");
        $(".signup-wrapper").removeClass("inactive").addClass("active");
      });

      $("#click-signin").click(function() {
        $(".signup-wrapper").removeClass("active").addClass("inactive");
        $(".signin-wrapper").removeClass("inactive").addClass("active");
      });

      // mobile/desktop ë·° ì „í™˜
      $("#mobile").click(function() {
        $(".root").css("max-width", "100%");
      });

      $("#desk").click(function() {
        $(".root").css("max-width", "400px");
      });

      // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
      $("#password, #confirmPassword").on("input", function() {
        var password = $("#password").val();
        var confirmPassword = $("#confirmPassword").val();

        if(confirmPassword) {
          if(password === confirmPassword) {
            $("#passwordMatch").html('<div class="alert-success"><p>ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤</p></div>');
          } else {
            $("#passwordMatch").html('<div class="alert-danger"><p>ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</p></div>');
          }
        }
      });

      // íšŒì› ìœ í˜•ì— ë”°ë¥¸ í•„ë“œ í‘œì‹œ
      $("#role").on("change", function() {
        var role = $(this).val();
        if(role === 'MANAGER') {
          $(".business-fields").show();
          $("#nameLabel").text("ë²•ì¸ëª… ë° ëŒ€í‘œìëª…");
          $("#name").attr("placeholder", "ë²•ì¸ëª… ë° ëŒ€í‘œìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
          $("input[name='businessNumber']").prop('required', true);
        } else {
          $(".business-fields").hide();
          $("#nameLabel").text("ì´ë¦„");
          $("#name").attr("placeholder", "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
          $("input[name='businessNumber']").prop('required', false);
          $("input[name='businessNumber']").val('');
        }
      });

      // í¼ ì œì¶œ ì‹œ ì£¼ì†Œ ì¡°í•©
      $('form').on('submit', function() {
        var zipcode = $('#zipcode').val();
        var address = $('#address').val();
        var addressDetail = $('#addressDetail').val();

        if(zipcode && address) {
          var fullAddress = '[' + zipcode + '] ' + address;
          if(addressDetail) {
            fullAddress += ' ' + addressDetail;
          }
          $('#address').val(fullAddress);
        }
      });
    });

    // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
    function checkEmail() {
      var email = $("#email").val();
      if(!email) {
        alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if(!emailRegex.test(email)) {
        alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
        return;
      }

      $.ajax({
        url: "/members/check-email",
        type: "GET",
        data: { email: email },
        success: function(response) {
          if(response.available) {
            $("#emailStatus").html('<div class="alert-success"><p>ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤</p></div>');
          } else {
            $("#emailStatus").html('<div class="alert-danger"><p>ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤</p></div>');
          }
        },
        error: function() {
          alert("ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      });
    }

    // ë‹¤ìŒ ì£¼ì†Œ API
    function execDaumPostcode() {
      new daum.Postcode({
        oncomplete: function(data) {
          var zipcode = data.zonecode;
          var addr = data.roadAddress;

          document.getElementById('zipcode').value = zipcode;
          document.getElementById('address').value = addr;

          document.getElementById('addressDetail').focus();
        }
      }).open();
    }
  </script>
</div>
</html>